<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор конверсии</title>
    <script src="https://art009bas.github.io/reestr/tailwind.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        .conversion-card {
            transition: all 0.3s ease;
        }
        
        .conversion-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .select-dropdown {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1em;
        }
        
        .history-item {
            border-left: 4px solid #3b82f6;
            transition: all 0.2s;
        }
        
        .history-item:hover {
            background-color: #f9fafb;
        }
        
        .floating-btn {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        
        .floating-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Шапка приложения -->
        <header class="mb-10">
            <div class="flex justify-between items-center">
                <h1 class="text-3xl font-bold text-gray-800">
                    <i class="fas fa-chart-line text-blue-500 mr-3"></i>
                    Калькулятор конверсии
                </h1>
              
            </div>
            <p class="text-gray-500 mt-2">Измерение эффективности веб-сайта или маркетинговой кампании</p>
        </header>
        
        <main>
            <!-- Калькулятор конверсии -->
            <div class="bg-white rounded-xl shadow-md overflow-hidden mb-8 fade-in">
                <div class="p-6 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                        <i class="fas fa-calculator text-blue-500 mr-3"></i>
                        Калькулятор конверсии
                    </h2>
                </div>
                
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-gray-700 mb-2">Количество посетителей</label>
                            <input type="number" id="visitors-input" placeholder="0" min="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Количество целевых действий</label>
                            <input type="number" id="actions-input" placeholder="0" min="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg mb-6">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">Формула конверсии:</h3>
                        <p class="text-sm text-gray-600">Конверсия = (Целевые действия / Кол-во посетителей) × 100%</p>
                    </div>
                    
                    <div class="flex justify-center mb-6">
                        <button id="calculate-btn" class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center">
                            <i class="fas fa-calculator mr-2"></i> Рассчитать конверсию
                        </button>
                    </div>
                    
                    <div id="result-container" class="hidden bg-blue-50 p-6 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-blue-800 mb-2">Результат конверсии</h3>
                        <div id="conversion-result" class="text-2xl font-bold text-blue-600 mb-3"></div>
                        <button id="copy-result-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm">
                            <i class="fas fa-copy mr-2"></i> Копировать результат
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- История конверсий -->
            <div class="bg-white rounded-xl shadow-md overflow-hidden fade-in">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                            <i class="fas fa-history text-purple-500 mr-3"></i>
                            История расчетов
                        </h2>
                        <button id="clear-history-btn" class="px-3 py-1 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 text-sm">
                            <i class="fas fa-trash-alt mr-1"></i> Очистить историю
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <div id="history-container">
                        <div class="text-center py-10 text-gray-400" id="no-history-message">
                            <i class="fas fa-clock text-4xl mb-3"></i>
                            <p>История расчетов пуста</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <footer class="mt-16 text-center text-gray-500 text-sm pb-8">
            <p>© 2025 Калькулятор конверсии. Все права защищены.</p>
        </footer>
    </div>

    <script>
        // Состояние приложения
        const state = {
            conversions: []
        };
        
        // Элементы DOM
        const elements = {
            visitorsInput: document.getElementById('visitors-input'),
            actionsInput: document.getElementById('actions-input'),
            calculateBtn: document.getElementById('calculate-btn'),
            resultContainer: document.getElementById('result-container'),
            conversionResult: document.getElementById('conversion-result'),
            copyResultBtn: document.getElementById('copy-result-btn'),
            historyContainer: document.getElementById('history-container'),
            noHistoryMessage: document.getElementById('no-history-message'),
            clearHistoryBtn: document.getElementById('clear-history-btn')
        };
        
        // Инициализация приложения
        function init() {
            // Загружаем данные из localStorage
            loadData();
            
            // Обработчики событий
            setupEventListeners();
            
            // Рендерим историю
            renderHistory();
        }
        
        // Загрузка данных из localStorage
        function loadData() {
            const savedData = localStorage.getItem('conversionCalculator');
            if (savedData) {
                const data = JSON.parse(savedData);
                state.conversions = data.conversions || [];
            }
        }
        
        // Сохранение данных в localStorage
        function saveData() {
            const data = {
                conversions: state.conversions
            };
            localStorage.setItem('conversionCalculator', JSON.stringify(data));
        }
        
        // Расчет конверсии
        function calculateConversion() {
            const visitors = parseInt(elements.visitorsInput.value);
            const actions = parseInt(elements.actionsInput.value);
            
            // Валидация
            if (isNaN(visitors) || visitors <= 0) {
                alert('Пожалуйста, введите корректное количество посетителей');
                return;
            }
            
            if (isNaN(actions) || actions < 0) {
                alert('Пожалуйста, введите корректное количество целевых действий');
                return;
            }
            
            if (actions > visitors) {
                alert('Количество целевых действий не может превышать количество посетителей');
                return;
            }
            
            // Расчет конверсии
            const conversionRate = (actions / visitors) * 100;
            
            // Форматирование результата
            const formattedResult = new Intl.NumberFormat('ru-RU', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(conversionRate);
            
            // Показываем результат
            elements.conversionResult.textContent = `${formattedResult}%`;
            elements.resultContainer.classList.remove('hidden');
            
            // Сохраняем в историю
            const conversion = {
                id: Date.now(),
                date: new Date().toISOString(),
                visitors: visitors,
                actions: actions,
                result: conversionRate
            };
            
            state.conversions.unshift(conversion);
            saveData();
            renderHistory();
        }
        
        // Рендер истории расчетов
        function renderHistory() {
            if (state.conversions.length === 0) {
                elements.noHistoryMessage.classList.remove('hidden');
                elements.historyContainer.innerHTML = '';
            } else {
                elements.noHistoryMessage.classList.add('hidden');
                
                let historyHTML = '';
                state.conversions.forEach(conversion => {
                    const date = new Date(conversion.date);
                    const dateString = date.toLocaleDateString('ru-RU', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    const formattedResult = new Intl.NumberFormat('ru-RU', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    }).format(conversion.result);
                    
                    historyHTML += `
                        <div class="history-item bg-white p-4 rounded-lg mb-3 fade-in">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="font-semibold text-gray-800">Конверсия: ${formattedResult}%</div>
                                    <div class="text-sm text-gray-500 mt-1">${conversion.actions} действий / ${conversion.visitors} посетителей</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm text-gray-500">${dateString}</div>
                                    <button class="delete-conversion text-red-400 hover:text-red-600 mt-1" data-id="${conversion.id}">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                elements.historyContainer.innerHTML = historyHTML;
                
                // Добавляем обработчики для кнопок удаления
                document.querySelectorAll('.delete-conversion').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const conversionId = parseInt(this.getAttribute('data-id'));
                        deleteConversion(conversionId);
                    });
                });
            }
        }
        
        // Удаление расчета из истории
        function deleteConversion(id) {
            state.conversions = state.conversions.filter(c => c.id !== id);
            saveData();
            renderHistory();
        }
        
        // Очистка истории
        function clearHistory() {
            if (confirm('Вы уверены, что хотите очистить всю историю расчетов? Это действие нельзя отменить.')) {
                state.conversions = [];
                saveData();
                renderHistory();
            }
        }
        
        // Копирование результата в буфер обмена
        function copyResultToClipboard() {
            const resultText = elements.conversionResult.textContent;
            navigator.clipboard.writeText(resultText).then(() => {
                // Временно меняем текст кнопки
                const originalText = elements.copyResultBtn.innerHTML;
                elements.copyResultBtn.innerHTML = '<i class="fas fa-check mr-2"></i> Скопировано!';
                
                setTimeout(() => {
                    elements.copyResultBtn.innerHTML = originalText;
                }, 2000);
            }).catch(err => {
                console.error('Ошибка копирования: ', err);
                alert('Не удалось скопировать результат');
            });
        }
        
        // Настройка обработчиков событий
        function setupEventListeners() {
            // Расчет конверсии
            elements.calculateBtn.addEventListener('click', calculateConversion);
            
            // Расчет по нажатию Enter в любом поле
            elements.visitorsInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    calculateConversion();
                }
            });
            
            elements.actionsInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    calculateConversion();
                }
            });
            
            // Копирование результата
            elements.copyResultBtn.addEventListener('click', copyResultToClipboard);
            
            // Очистка истории
            elements.clearHistoryBtn.addEventListener('click', clearHistory);
        }
        
        // Инициализация приложения при загрузке страницы
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
